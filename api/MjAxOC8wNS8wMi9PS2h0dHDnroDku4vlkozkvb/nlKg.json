{"title":"OKhttp简介和使用","date":"2018-05-01T16:00:00.000Z","date_formatted":{"ll":"May 2, 2018","L":"05/02/2018","MM-DD":"05-02"},"link":"2018/05/02/OKhttp简介和使用","tags":["Android"],"updated":"2020-02-09T08:38:23.000Z","content":"<h2 id=\"简介\"><strong>简介</strong><a href=\"#简介\" title=\"简介\"></a></h2><p>android网络框架之OKhttp<br>一个处理网络请求的开源项目,是安卓端最火热的轻量级框架,由移动支付Square公司贡献(该公司还贡献了Picasso)<br>用于替代HttpUrlConnection和Apache HttpClient</p>\n<h4 id=\"官方资料\">官方资料<a href=\"#官方资料\" title=\"官方资料\"></a></h4><blockquote>\n<p><a href=\"http://square.github.io/okhttp/\" target=\"_blank\">官方介绍</a></p>\n</blockquote>\n<blockquote>\n<p><a href=\"https://github.com/square/okhttp\" target=\"_blank\">github源码</a></p>\n</blockquote>\n<h4 id=\"优势\">优势<a href=\"#优势\" title=\"优势\"></a></h4><ul><li>允许连接到同一个主机地址的所有请求,提高请求效率</li>\n<li>共享Socket,减少对服务器的请求次数  </li>\n</ul><ul><li>通过连接池,减少了请求延迟</li>\n<li>缓存响应数据来减少重复的网络请求  </li>\n<li>减少了对数据流量的消耗</li>\n<li>自动处理GZip压缩</li>\n</ul><h4 id=\"功能\">功能<a href=\"#功能\" title=\"功能\"></a></h4><ul><li>get,post请求</li>\n<li>文件的上传下载</li>\n<li>加载图片(内部会图片大小自动压缩)</li>\n<li>支持请求回调，直接返回对象、对象集合</li>\n<li>支持session的保持<blockquote>\n</blockquote>\n</li>\n</ul><h4 id=\"效果图\">效果图<a href=\"#效果图\" title=\"效果图\"></a></h4><p><img src=\"https://github.com/jccjd/L_OkHttp/blob/master/app/src/main/res/drawable/l1525091941778.gif?raw=true\" class=\"φcy\" alt=\"image\"></p>\n<h4 id=\"相关使用\">相关使用<a href=\"#相关使用\" title=\"相关使用\"></a></h4><blockquote>\n<p>添加依赖（build.gradle）</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">compile &#39;com.squareup.okhttp3:okhttp:3.10.0&#39;</span><br></pre></td></tr></table></figure><blockquote>\n<p>添加网络设置</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;uses-permission android:name&#x3D;&quot;android.permission.INTERNET&quot;&#x2F;&gt;</span><br></pre></td></tr></table></figure><h6 id=\"get\">Get<a href=\"#get\" title=\"Get\"></a></h6><ol><li>通过build来创建一个Request请求，可以不设置get默认方法就是get<br>url是访问地址（BASE_URL这里用的是虚拟机的基地址）</li>\n</ol><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">String BASE_URL &#x3D; &quot;http:&#x2F;&#x2F;10.0.2.2&#x2F;get.php?key&#x3D;get&quot;;</span><br><span class=\"line\">        OkHttpClient okHttpClient &#x3D; new OkHttpClient();</span><br><span class=\"line\"></span><br><span class=\"line\">        Request request &#x3D; new Request.Builder()</span><br><span class=\"line\">        .url(BASE_URL)</span><br><span class=\"line\">        .get()</span><br><span class=\"line\">        .build();</span><br></pre></td></tr></table></figure><ol><li>创建Call对象参数就是Request请求对象发送请求</li>\n</ol><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Call call &#x3D; okHttpClient.newCall(request);</span><br><span class=\"line\">call.enqueue(callback);</span><br></pre></td></tr></table></figure><p>3.然后以异步方式执行请求</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">okHttpUtil.requestGet(new Callback() &#123;</span><br><span class=\"line\">           &#x2F;&#x2F;请求失败执行方法</span><br><span class=\"line\">           @Override</span><br><span class=\"line\">           public void onFailure(Call call, IOException e) &#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">           &#x2F;&#x2F;请求成功执行方法，request就是从服务器得到参数，request.body()可以得到任意类型，字符串，字节。</span><br><span class=\"line\">           @Override</span><br><span class=\"line\">           public void onResponse(Call call, Response response) throws IOException &#123;</span><br><span class=\"line\">               String strRet &#x3D; response.body().string();</span><br><span class=\"line\">               &#x2F;&#x2F;将数据存到Handler中</span><br><span class=\"line\">               Message msg &#x3D; mHandler.obtainMessage();</span><br><span class=\"line\">               msg.obj &#x3D; &quot;Get方法获取数据 ----&gt; &quot;+&quot;  &quot; + strRet;</span><br><span class=\"line\">               mHandler.sendMessage(msg);</span><br><span class=\"line\">           &#125;</span><br><span class=\"line\">       &#125;);</span><br><span class=\"line\">   &#125;</span><br></pre></td></tr></table></figure><h6 id=\"post\">Post<a href=\"#post\" title=\"Post\"></a></h6><p>Post与get类似 post的参数是包含在请去体中所以需要Formbody添加键值对</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">FormBody formBody &#x3D; new FormBody.Builder().add(&quot;key&quot;, &quot;Post&quot;).build();</span><br></pre></td></tr></table></figure><p>其他部分大致相同</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public static void requestPost(Callback callback) &#123;</span><br><span class=\"line\">        String BASE_URL &#x3D; &quot;http:&#x2F;&#x2F;10.0.2.2&#x2F;post.php&quot;;</span><br><span class=\"line\">        OkHttpClient okHttpClient &#x3D; new OkHttpClient();</span><br><span class=\"line\">        FormBody formBody &#x3D; new FormBody</span><br><span class=\"line\">                .Builder()</span><br><span class=\"line\">                .add(&quot;key&quot;, &quot;Post&quot;)</span><br><span class=\"line\">                .build();</span><br><span class=\"line\"></span><br><span class=\"line\">        Request request &#x3D; new Request</span><br><span class=\"line\">                .Builder()</span><br><span class=\"line\">                .url(BASE_URL)</span><br><span class=\"line\">                .post(formBody)</span><br><span class=\"line\">                .build();</span><br><span class=\"line\"></span><br><span class=\"line\">        Call call &#x3D; okHttpClient.newCall(request);</span><br><span class=\"line\">        call.enqueue(callback);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">     private void httpPost() &#123;</span><br><span class=\"line\">        okHttpUtil.requestGet(new Callback() &#123;</span><br><span class=\"line\">            @Override</span><br><span class=\"line\">            public void onFailure(Call call, IOException e) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            @Override</span><br><span class=\"line\">            public void onResponse(Call call, Response response) throws IOException &#123;</span><br><span class=\"line\">                String strRet &#x3D; response.body().string();</span><br><span class=\"line\">                Message msg &#x3D; mHandler.obtainMessage();</span><br><span class=\"line\">                msg.obj &#x3D; &quot;Post方法获取数据 ---&gt; &quot;+&quot;  &quot; +strRet;</span><br><span class=\"line\">                mHandler.sendMessage(msg);</span><br><span class=\"line\"></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure><p>源码见我的github –&gt; <a href=\"https://github.com/jccjd/L_OkHttp/\" target=\"_blank\">jccjd</a></p>\n","prev":{"title":"Retrofit","link":"2018/05/14/Retrofit"},"next":{"title":"linux下配置git","link":"2017/12/07/linux下配置git"},"plink":"http://yoursite.com/2018/05/02/OKhttp简介和使用/","toc":[{"id":"简介","title":"简介","index":"1"}]}