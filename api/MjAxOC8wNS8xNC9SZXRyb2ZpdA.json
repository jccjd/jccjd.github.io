{"title":"Retrofit","date":"2018-05-13T16:00:00.000Z","date_formatted":{"ll":"May 14, 2018","L":"05/14/2018","MM-DD":"05-14"},"link":"2018/05/14/Retrofit","tags":["Android"],"updated":"2020-02-09T08:38:25.000Z","content":"<h5 id=\"json是什么？\">Json是什么？<a href=\"#json是什么？\" title=\"Json是什么？\"></a></h5><p>json(Javascript Object Notation)是一种轻量级的数据交换格式，相比于xml这种数据交换格式来说，<br>因为解析xml比较的复杂，而且需要编写大段的代码，所以客户端和服务器的数据交换格式往往通过json来进行交换。<br>尤其是对于web开发来说，json数据格式在客户端直接可以通过javascript来进行解析。</p>\n<p><img src=\"http://www.json.org/object.gif\" class=\"φcy\" alt=\"image\"></p>\n<p>json一共有两种数据结构，一种是以 (key/value)对形式存在的无序的jsonObject对象，<br>一个对象以“{”（左花括号）开始，“}”（右花括号）结束。每个“名称”后跟一个“:”（冒号）；<br>“‘名称/值’ 对”之间使用“,”（逗号）分隔。</p>\n<p><img src=\"http://www.json.org/array.gif\" class=\"φcy\" alt=\"image\"></p>\n<p>例如：{“name”: “xiaoluo”}， 这就是一个最简单的json对象，对于这种数据格式，key值必须要是string类型，<br>而对于value，则可以是string、number、object、array等数据类型：</p>\n<p><img src=\"http://www.json.org/value.gif\" class=\"φcy\" alt=\"image\"></p>\n<p>关于详尽数据格式参见 –&gt; <a href=\"https://note.youdao.com/\" target=\"_blank\">http://www.json.org/json-zh.html</a></p>\n<h5 id=\"概述\">概述<a href=\"#概述\" title=\"概述\"></a></h5><p>本文主要阐述的有关于用retrofit来获取服务器端json数据, 并进行解析，相关demo在(<a href=\"https://github.com/jccjd/L_json)上\" target=\"_blank\">https://github.com/jccjd/L_json)上</a></p>\n<hr>\n<p>Retrofit是一套RESTful架构的Android(Java)客户端实现，基于注解，提供JSON to POJO(Plain Ordinary Java Object,简单Java对象)，POJO to JSON，网络请求(POST，GET,PUT，DELETE等)封装</p>\n<p><strong>类结构如图</strong></p>\n<p><img src=\"https://github.com/jccjd/L_json/blob/master/app/src/main/res/drawable/buhuo.PNG?raw=true\" class=\"φcy\" alt=\"image\"></p>\n<p>先添加依赖</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">compile &#39;com.squareup.retrofit2:retrofit:2.4.0&#39;</span><br><span class=\"line\">compile &#39;com.squareup.retrofit2:converter-gson:2.4.0&#39;</span><br></pre></td></tr></table></figure><p>需要解析的json字符是这样的</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?php</span><br><span class=\"line\"> for ($i&#x3D;0; $i &lt; 5 ; $i++) &#123;</span><br><span class=\"line\"> \t# code...</span><br><span class=\"line\"> \t$newsArray[$i] &#x3D; array(&#39;title&#39;&#x3D;&gt;&#39;biaoti&#39;.$i,&#39;content&#39;&#x3D;&gt;&#39;neirong&#39;,&#39;newsImageUrl&#39;&#x3D;&gt;&#39;http&#x2F;&#x2F;10.0.2.2&#x2F;image&#x2F;news&#x2F;1.jpg&#39;);</span><br><span class=\"line\"> &#125;</span><br><span class=\"line\"> $jsonArray &#x3D; array(&#39;code&#39;&#x3D;&gt;0,&#39;message&#39;&#x3D;&gt;&#39;success&#39;,&#39;data&#39;&#x3D;&gt;$newsArray);</span><br><span class=\"line\"> echo json_encode($jsonArray);</span><br></pre></td></tr></table></figure><p>httpResult通过定义泛型</p>\n<p>利用接口和注解创建ApiService</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public interface ApiService &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    @GET(&quot;json.php&quot;)</span><br><span class=\"line\"></span><br><span class=\"line\">    Call&lt;HttpResult&lt;List&lt;news&gt;&gt;&gt; getNews();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><p>然后是简单的布局就一个button绑定事件 和 一个TextView显示获取的数据</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;utf-8&quot;?&gt;</span><br><span class=\"line\">&lt;LinearLayout</span><br><span class=\"line\">        xmlns:android&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;apk&#x2F;res&#x2F;android&quot;</span><br><span class=\"line\">        xmlns:tools&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;tools&quot;</span><br><span class=\"line\">        xmlns:app&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;apk&#x2F;res-auto&quot;</span><br><span class=\"line\">        android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">        android:orientation&#x3D;&quot;vertical&quot;</span><br><span class=\"line\">        android:layout_height&#x3D;&quot;match_parent&quot;</span><br><span class=\"line\">        tools:context&#x3D;&quot;com.example.lenovo.l_json.MainActivity&quot;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;Button android:layout_width&#x3D;&quot;wrap_content&quot; android:layout_height&#x3D;&quot;wrap_content&quot;</span><br><span class=\"line\">    android:id&#x3D;&quot;@+id&#x2F;btn_Json&quot;&#x2F;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;TextView</span><br><span class=\"line\">            android:layout_width&#x3D;&quot;wrap_content&quot;</span><br><span class=\"line\">            android:id&#x3D;&quot;@+id&#x2F;tv_show_msg&quot;</span><br><span class=\"line\">            android:layout_height&#x3D;&quot;wrap_content&quot;</span><br><span class=\"line\">            android:text&#x3D;&quot;Hello World!&quot;</span><br><span class=\"line\">            app:layout_constraintBottom_toBottomOf&#x3D;&quot;parent&quot;</span><br><span class=\"line\">            app:layout_constraintLeft_toLeftOf&#x3D;&quot;parent&quot;</span><br><span class=\"line\">            app:layout_constraintRight_toRightOf&#x3D;&quot;parent&quot;</span><br><span class=\"line\">            app:layout_constraintTop_toTopOf&#x3D;&quot;parent&quot;&#x2F;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;&#x2F;LinearLayout&gt;</span><br></pre></td></tr></table></figure>","prev":{"title":"Rxjava的观察者模式","link":"2018/05/28/Rxjava的观察者模式"},"next":{"title":"OKhttp简介和使用","link":"2018/05/02/OKhttp简介和使用"},"plink":"http://yoursite.com/2018/05/14/Retrofit/","copyright":{"link":"<a href=\"http://yoursite.com/2018/05/14/Retrofit/\" title=\"Retrofit\">http://yoursite.com/2018/05/14/Retrofit/</a>","license":"自由转载-非商用-禁止演绎-保持署名 (<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow noopener\" target=\"_blank\">CC BY-NC-ND 4.0</a>)"}}